-- 제약조건은 아직 없습니다
-- (5/8 게시판들의 작성자 아이디, 게시판 내용등의 컬럼을 삭제)
-- (5/8 시퀀스 추가 시퀀스 이름 "테이블명_seq"으로 통일,  fund 테이블에 fund_no 수정 )
-- (5/9 팔로우 테이블, 구매내역 테이블, 채팅방, 채팅참여, 채팅 메세지 생성) 
-- (5/10 채팅방 관련 테이블 수정 및 전송, 좋아요 테이블 추가)
-- (5/10 fund_post테이블 fund_content 컬럼 추가)
-- (5/10 post 테이블 post_type 컬럼추가, 
-- 행사일정, 같이가요, 자유 게시물 테이블 추가

-- 멤버테이블
CREATE TABLE member (
	member_id varchar2(20) primary key,
	member_pw varchar2(20) NULL,
	member_nick	varchar2(30) NULL,
	member_point number	NULL,
	member_email varchar2(40) NULL,
	member_agree char(1) NULL,
	member_join	date default sysdate,
	member_level varchar2(12) NULL,
	member_login date NULL
);
create sequence member_seq;

-- 삭제 회원
CREATE TABLE delete_member (
	delete_id varchar2(20) NOT NULL,
	delete_time	date default sysdate
);

-- 첨부 파일
CREATE TABLE attachment (
	attachment_no number primary key,
	attachment_name	varchar2(100)	NULL,
	attachment_type	varchar2(15)	NULL,
	attachment_size	number	NULL
);
create sequence attachment_seq;

-- 회원 프로필 사진
CREATE TABLE member_profile_image (
	member_id references member(member_id) on delete cascade, 
	attachment_no references attachment(attachment_no) on delete cascade
);

-- 고정 태그 
CREATE TABLE fixed_tag (
	fixed_tag_no number primary key,
	fixed_tag_name varchar2(20) NULL
);
create sequence fixed_tag_seq;

-- 자유 태그
CREATE TABLE free_tag (
	free_tag_no	number primary key,
	free_tag_name varchar2(20) NULL
);
create sequence free_tag_seq;

-- 통합 게시물 
CREATE TABLE post (
	post_no	number primary key, 
	member_id references member(member_id) on delete cascade,
    -- 회원 탈퇴 시 작성 글 모두 삭제
    post_type varchar2(12),
	post_content varchar2(3000)	NULL,
	post_time date default sysdate
);
create sequence post_seq;

-- 고정 태그 정규화
CREATE TABLE post_fixed_tag (
	post_no	references post(post_no) on delete cascade,
	fixed_tag_no	references fixed_tag(fixed_tag_no) on delete cascade
);

-- 자유 태그 정규화 
CREATE TABLE post_free_tag (
	post_no	references post(post_no) on delete cascade,
	free_tag_no references free_tag(free_tag_no) on delete cascade
);


-- 통합 테이블 
CREATE TABLE intergrated_table (
	post_no references post(post_no) on delete cascade,
    member_id references member(member_id) on delete cascade,
    post_title varchar2(30) null 
);

-- 게시물 좋아요 
CREATE TABLE post_like (
	post_no primary key references post(post_no) on delete cascade,
	member_id references member(member_id) on delete cascade
);


-- 아이돌 
CREATE TABLE idol (
	idol_group	varchar2(30) primary key
);

-- 아이돌 좋아요 
CREATE TABLE idol_like(
    member_id primary key references member(member_id) on delete cascade,
    -- 회원탈퇴 시 해당 회원의 좋아요 사라짐
    idol_group references idol(idol_group) on delete cascade
    -- 아이돌 그룹 페이지 삭제 시 회원의 좋아요 사라짐 
);

-- 일정 게시물
CREATE TABLE schedule_post (
	post_no	primary key references post(post_no) on delete cascade,
	member_id references member(member_id) on delete cascade,
	schedule_start date NULL,
	schedule_end date NULL
);

-- 펀딩 게시물
CREATE TABLE fund_post (
	post_no	references post(post_no) on delete cascade,
	member_id references member(member_id) on delete cascade,
	fund_title	varchar2(30) NULL,
	post_start date	NULL, -- 일정 시작 날자 
	post_end date NULL, -- 일정 종료 날짜
	fund_goal number NULL,
	fund_sponsor_count number NULL,
	fund_state varchar2(9) NULL -- 완료, 실패, 외 두 가지 
);

-- 펀딩 테이블
CREATE TABLE fund (
	fund_no	number primary key,
	post_no	number references post(post_no) on delete cascade,
	fund_price number NULL,
	fund_id	varchar2(20) NULL,
	fund_time date NULL
);
create sequence fund_seq;

-- 같이가요 테이블
CREATE TABLE together_post(
    post_no references post(post_no) on delete cascade,
    member_id references member(member_id) on delete cascade,
    together_start date,
    together_end date
);

-- 자유 게시물
CREATE TABLE free_post(
    post_no references post(post_no) on delete cascade,
    member_id references member(member_id) on delete cascade
);

-- 댓글
CREATE TABLE reply (
    reply_no number primary key,
	post_no references post(post_no) on delete cascade,
	reply_id varchar2(20) NULL,
	reply_content varchar2(1000) NULL,
	reply_time date NULL,
	reply_group	varchar2(20) NULL
);
create sequence reply_seq;

-- 댓글 좋아요
CREATE TABLE reply_like (
	reply_no primary key references reply(reply_no)on delete cascade,
	member_id references member(member_id) on delete cascade
);

-- 게시물 사진
CREATE TABLE post_image (
	attachment_no number primary key references attachment(attachment_no) on delete cascade,
    post_no	number references post(post_no) on delete cascade
);

-- 포인트 사용 내역
CREATE TABLE point (
    member_id primary key references member(member_id) on delete cascade,
    point_remain number,
    point_use number
);

-- 팔로우
CREATE TABLE follow (
    member_id primary key references member(member_id) on delete cascade,
    sender_id varchar2(20),
    receiver_id varchar2(20)
);

-- 채팅 방 
CREATE TABLE chat_room(
	chat_room_no NUMBER PRIMARY KEY,
	chat_room_name varchar2(60),
	chat_room_start DATE DEFAULT sysdate NOT NULL
);
CREATE SEQUENCE chat_room_seq;

-- 채팅 참여
CREATE TABLE chat_join(
	member_id REFERENCES member(member_id) ON DELETE SET NULL,
	chat_room_no NUMBER REFERENCES chat_room(chat_room_no) ON DELETE CASCADE,
	chat_join_time DATE DEFAULT sysdate NOT NULL,
	PRIMARY KEY(chat_room_no, member_id)
);

-- 채팅 메세지
CREATE TABLE CHAT_MESSAGE(
	chat_message_no NUMBER PRIMARY KEY,
	member_id REFERENCES member(member_id) ON DELETE SET NULL,
	chat_room_no REFERENCES chat_room(chat_room_no) ON DELETE CASCADE NOT NULL,
	chat_message_time DATE DEFAULT sysdate NOT NULL,
	chat_message_content varchar2(900) NOT NULL
);
CREATE SEQUENCE chat_message_seq;

-- 채팅 전송
CREATE TABLE chat_read(
	chat_room_no REFERENCES chat_room(chat_room_no) ON DELETE CASCADE,
	chat_message_no REFERENCES chat_message(chat_message_no) ON DELETE CASCADE,
	chat_sender REFERENCES member(member_id) ON DELETE SET NULL,
	chat_reciever varchar2(20) NOT NULL,
	chat_read_time DATE DEFAULT sysdate
);

-- 채팅 좋아요
CREATE TABLE chat_like(
	chat_message_no REFERENCES chat_message(chat_message_no) ON DELETE CASCADE NOT NULL,
	member_id REFERENCES member(member_id) ON DELETE CASCADE NOT NULL,
	PRIMARY KEY(chat_message_no, member_id)
);

commit;